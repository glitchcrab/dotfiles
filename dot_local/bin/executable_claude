#!/usr/bin/env bash

# get the current directory
CURRENT_DIR_PATH="${PWD##}"
CURRENT_DIR_NAME="${PWD##*/}"
BASE_DIR="${HOME}/temp/bubblewrap"

bwrap \
    --ro-bind /usr /usr \
    --ro-bind /lib /lib \
    --ro-bind /lib64 /lib64 \
    --ro-bind /bin /bin \
    --ro-bind /etc/resolv.conf /etc/resolv.conf \
    --ro-bind /etc/hosts /etc/hosts \
    --ro-bind /etc/ssl /etc/ssl \
    # required for Arch's invocation of Claude
    --ro-bind /opt/claude-code /opt/claude-code \
    # let Claude access its config
    --bind "${HOME}/.claude" "${HOME}/.claude" \
    --bind "${HOME}/.claude.json" "${HOME}/.claude.json" \
    # required for the vscode plugin to work
    --bind "${HOME}/.vscode/" "${HOME}/.vscode/" \
    --tmpfs /tmp \
    --proc /proc \
    --dev /dev \
    --share-net \
    --unshare-pid \
    --die-with-parent \
    --bind "${CURRENT_DIR_PATH}" "${BASE_DIR}/${CURRENT_DIR_NAME}" \
    --chdir "${BASE_DIR}/${CURRENT_DIR_NAME}" \
    # start Claude and pass all arguments through
    /usr/bin/claude "$@"

